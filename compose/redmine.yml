#
# Redmine
#
# - redmine
# - postgresql
#

redmine:
    image: sameersbn/redmine:3.1.3
    hostname: redmine.<%=domain%>
    restart: always
    links:
     - redminepostgresql:postgresql
     - ldap
    environment:
     - "VIRTUAL_HOST=http://redmine.<%=httpHost%>,https://redmine.<%=httpsHost%>"
     - SSL_CERT=<%=sslcert%>
     #- TZ=Europe/Paris
     - REDMINE_PORT=<%=httpsPort%>
     - REDMINE_HTTPS=true
     #- SMTP_ENABLED=false
     #- SMTP_DOMAIN=www.example.com
     #- SMTP_HOST=smtp.gmail.com
     #- SMTP_PORT=587
     #- SMTP_USER=mailer@example.com
     #- SMTP_PASS=password
     #- SMTP_STARTTLS=true
     #- SMTP_AUTHENTICATION=:login
     #- IMAP_ENABLED=false
     #- IMAP_USER=mailer@example.com
     #- IMAP_PASS=password
     #- IMAP_HOST=imap.gmail.com
     #- IMAP_PORT=993
     #- IMAP_SSL=true
     #- IMAP_INTERVAL=30
    volumes_from:
     - redminedata

redminepostgresql:
    image: sameersbn/postgresql:9.4-10
    restart: always
    environment:
     - DB_USER=redmine
     - DB_PASS=<%=rootpassword%>
     - DB_NAME=redmine_production
    volumes_from:
     - redminepostgresqldata

redminedata:
    image: debian:jessie
    command: echo ready
    volumes:
     - /home/redmine/data

redminepostgresqldata:
    image: debian:jessie
    command: echo ready
    volumes:
     - /var/lib/postgresql

redminebackup:
    image: sameersbn/postgresql:9.4-10
    command: echo ready
    links:
     - redminepostgresql:postgresql
    volumes:
     - ./redmine-init.sql:/redmine-init.sql:ro
    volumes_from:
     - redminedata
     - backup
